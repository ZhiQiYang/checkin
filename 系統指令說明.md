# LINE 打卡系統 - 指令功能文檔

## 基本功能介紹

LINE 打卡系統提供了以下基本功能：
1. 上班/下班打卡
2. 查詢打卡記錄
3. 匯出打卡資料
4. 群組訊息功能
5. 管理員功能

## 打卡指令

### 上班打卡
指令：`上班`
功能：記錄上班時間和位置
說明：系統會記錄您的當前位置（需允許位置權限）和時間

### 下班打卡
指令：`下班`
功能：記錄下班時間和位置
說明：系統會記錄您的當前位置（需允許位置權限）和時間，必須先完成上班打卡才能執行下班打卡

## 查詢指令

### 查詢今日打卡
指令：`查詢今日`
功能：查詢今天的打卡記錄
說明：顯示今天的上班和下班記錄

### 查詢歷史紀錄
指令：`查詢歷史`
功能：查詢過去的打卡記錄
說明：會顯示過去一段時間內的打卡記錄

## 匯出功能

### 匯出打卡記錄
指令：`匯出記錄`
功能：將打卡記錄匯出為各種格式
說明：打開匯出介面，可以選擇不同的匯出格式和時間範圍

#### 新增匯出格式
本系統現在支援以下匯出格式：

1. **Excel 格式**：
   - 匯出為標準的 Excel (.xlsx) 檔案
   - 含有完整的打卡記錄資訊
   - 支援各種時間範圍（一週、一個月、三個月、全部）

2. **PDF 格式**（新功能）：
   - 匯出為 PDF 格式文件
   - 包含漂亮的表格和標題
   - 適合直接列印或正式文件存檔

3. **Google Sheets 格式**（新功能）：
   - 直接匯出到 Google 雲端試算表
   - 可以在線分享和協作編輯
   - 自動套用格式化和標題

#### 如何使用匯出功能：
1. 在 LINE 機器人中輸入「匯出記錄」
2. 在開啟的網頁中選擇時間範圍
3. 選擇您希望的匯出格式（Excel、PDF 或 Google Sheets）
4. 點擊對應的匯出按鈕
5. 下載或在新視窗中查看匯出結果

#### 注意事項：
- Google Sheets 匯出功能需要您授權訪問您的 Google 帳戶
- 匯出大量資料可能需要較長時間處理
- PDF 格式適合直接列印，而 Excel 和 Google Sheets 適合進一步資料分析

## 管理員功能

### 查看所有記錄
指令：`管理員查詢`
功能：查看所有用戶的打卡記錄
權限：僅限系統管理員使用

### 匯出所有記錄
指令：`管理員匯出`
功能：匯出所有用戶的打卡記錄
權限：僅限系統管理員使用

## 提醒功能設定

### 查看提醒設置
指令：`!設定提醒`
功能：查看當前的提醒設置和設定選項
說明：顯示當前的上下班提醒時間、提醒狀態，並提供修改選項

### 設定上班提醒時間
指令：`!設定上班提醒 HH:MM`
功能：設定上班打卡提醒時間
說明：系統會在指定時間檢查您是否已打卡，如果尚未打卡則發送提醒
範例：`!設定上班提醒 09:30` - 設置上班提醒時間為早上9點30分

### 設定下班提醒時間
指令：`!設定下班提醒 HH:MM`
功能：設定下班打卡提醒時間
說明：系統會在指定時間檢查您是否已打卡，如果尚未打卡則發送提醒
範例：`!設定下班提醒 18:30` - 設置下班提醒時間為晚上6點30分

### 提醒時間格式說明
- 時間格式必須為 `HH:MM`，例如：`09:00`、`18:30`
- 小時為 24 小時制，可以是 00-23
- 分鐘可以是 00-59
- 上班提醒建議設定在早上 6:00 至 11:00 之間
- 下班提醒建議設定在下午 17:00 至 20:00 之間

### 進階提醒設置
如需設置更多提醒選項（如週末提醒、節假日提醒等），請使用網頁版設置功能：
1. 在 LINE 機器人中輸入「!設定提醒」
2. 點擊回覆訊息中的連結
3. 在網頁中進行詳細設置

## 一般用戶指令

所有使用者都可以使用以下指令：

| 指令 | 功能描述 |
|------|----------|
| `!上班打卡` | 快速完成上班打卡，無需開啟打卡頁面 |
| `!下班打卡` | 快速完成下班打卡，無需開啟打卡頁面 |
| `!快速打卡` | 同 `!上班打卡`，快速完成上班打卡 |
| `!打卡報表` | 產生並顯示個人打卡統計報表連結 |
| `!測試提醒` | 發送測試提醒訊息到用戶LINE帳號 |
| `!系統狀態` | 查看系統運行狀態，包括打卡數據統計 |
| `!幫助` | 顯示指令幫助信息 |
| `!管理指令` | 顯示管理員指令列表（僅管理員可使用） |
| `打卡` 或 `打卡連結` | 獲取打卡頁面連結 |

## 管理員指令

以下指令僅系統管理員可使用：

| 指令 | 功能描述 |
|------|----------|
| `!重置菜單` | 重置 LINE Rich Menu |
| `!診斷系統` | 執行系統診斷，並將報告發送給管理員 |
| `!備份數據` | 觸發數據庫備份操作 |
| `!清理緩存` | 清理系統緩存和臨時文件 |
| `!發送群通知` | 發送全群通知（透過管理面板使用） |

## 使用例子

1. **快速打卡**
   
   用戶在 LINE 中直接輸入 `!上班打卡`，系統會自動記錄打卡並發送確認訊息。

2. **查看報表**
   
   用戶輸入 `!打卡報表`，系統會回傳一個連結，點擊後可查看個人打卡記錄。

3. **測試提醒功能**
   
   用戶輸入 `!測試提醒`，系統會立即發送一條測試提醒到用戶的 LINE 帳號。

## 管理面板

管理員除了可以使用指令外，還可以訪問網頁管理面板進行更多操作：

1. 訪問管理面板：`/admin?userId=管理員的LINE用戶ID`
2. 查看系統日誌：`/admin/logs?userId=管理員的LINE用戶ID`

## 注意事項

1. 所有命令均需添加前綴 `!` 才能被識別為命令
2. 管理員命令僅管理員可使用，其他用戶使用會收到權限不足的提示
3. 快速打卡功能會記錄「快速打卡」作為位置信息
4. 使用指令前確保 LINE Bot 已加入為好友，否則無法接收系統回覆

## 擴充與定制

系統支持根據需求擴充更多指令，開發者可在 `routes/webhook.py` 文件中的命令處理部分添加新的指令邏輯。
